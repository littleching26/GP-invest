{% extends "base.html" %} {% block content %}
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ=="
    crossorigin="anonymous"> -->
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ=="
    crossorigin="anonymous"></script> 
<link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='assessment.css') }}">
<!-- <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">--> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> 

<section class="xop-container">
    <div class="xop-left text-position">
        <article>
            <h1>風險評估</h1>
            <div class="xop-button" data-toggle="modal" data-target="#myModal" id="riskAssessment">ENTER</div>
        </article>
    </div>
    <div class="xop-right text-position">
        <article>
            <h1>直接投資</h1>
            <div class="xop-button" onclick="redirect()">ENTER</div>
        </article>
    </div>
</section>
<div class="modal fade bd-example-modal-lg" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" \ aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div style="position: absolute; left: 50%;font-size: 2.5vmin;">
                    <div id="part" style="position: relative;left: -50%;bottom:0%;">Part I 人格測試</div>
                </div>
                <div class="modal-title" id="myModalLabel">風險評估表單</div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body" id="questionContent"></div>
            <div class="modal-footer">
                <div id="pageNum" style="position: absolute; left:50%"></div>
                <button type="button" class="btn btn btn-info" id="nextQuestion">Next</button>
                <!-- <button type="button" class="btn btn-danger" data-dismiss="modal">取消</button> -->
            </div>
        </div>
    </div>
</div>
<script>
    var count = 0;
    var pageNum = 1;
    var A_num = 0;
    var B_num = 0;
    var C_num = 0;
    var D_num = 0;

    function redirect() {
        window.location.href = 'directInvest';
    }
    function runFieldContent() {
        var xmlhttp = new XMLHttpRequest();
        var readQuestion = '';
        var questionArr = new Array();
        var questionArr = new Array();
        xmlhttp.overrideMimeType("text/html;charset=utf8");
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.status == 200 && xmlhttp.readyState == 4) {
                readQuestion = xmlhttp.responseText;
                questionArr = readQuestion.split("\r\n");
                fieldFormHtml(questionArr);
                detectFormClick();
            }
        };
        if(count<25){
            xmlhttp.open("GET", "./static/test.txt", true);
            xmlhttp.send();
        }
        else{
            xmlhttp.open("GET", "./static/securitiesInvestment.txt", true);
            xmlhttp.send();
        }
    }
    $('#riskAssessment').click(function () {
        runFieldContent();
    })
    function countABCD() {
        for (var i = count; i > count - 5; i--) {
            var stringValue = $("#rb-" + i).find('.rb-tab-active').attr("data-value")
            switch (stringValue) {
                case 'A':
                    A_num += 1;
                    break;
                case 'B':
                    B_num += 1;
                    break;
                case 'C':
                    C_num += 1;
                    break;
                case 'D':
                    D_num += 1;
                    break;
            }
        }
    }
    function personalityType(A_num, B_num, C_num, D_num){
        var maxValue = A_num;
        var type = '影響型';
        if(B_num>maxValue){
            type = '支配型';
        }else if(C_num>maxValue){
            type = '分析型';
        }else{
            type = '穩健型';
        }
        return type;
    }

    $("#nextQuestion").click(function () {
        countABCD();
        if ($("#nextQuestion").text() == 'Done') {
            window.location.href = 'invest' ;
        } else if($("#nextQuestion").text() == 'Go To The Next Part') {
            pageNum++;
            runFieldContent();
            console.log(A_num, B_num, C_num, D_num);
            var personType = personalityType(A_num, B_num, C_num, D_num) ;
            console.log(personType) ;
        }else{
            pageNum++;
            runFieldContent();
        }
    });
    $(document).ready(function () {
        $('#myModal').on('hidden.bs.modal', function () {
            count = 0;
            pageNum = 1;
            A_num = 0;
            B_num = 0;
            C_num = 0;
            D_num = 0;
            $('#questionContent').html('');
        });
    });
    function detectFormClick() {
        var survey = []; //Bidimensional array: [ [1,3], [2,4] ]

        //Switcher function:
        $(".rb-tab").click(function () {
            if ($(this).attr("data-value") != undefined) {
                $(this).parent().find(".rb-tab").removeClass("rb-tab-active");
                $(this).addClass("rb-tab-active");
            }
        });
        $(".partIIcontent").click(function () {
            if ($(this).attr("data-value") != undefined) {
                if((count-25) == 3){
                    // console.log($(this).attr("data-value"));
                    $(this).addClass("partIIcontent-active");
                }else{
                    // console.log($(this).attr("data-value"));
                    $(this).parent().find(".partIIcontent").removeClass("partIIcontent-active");
                    $(this).addClass("partIIcontent-active");
                }
            }
        });
    };
    function fieldFormHtml(questionArr) {
        $('#questionContent').html('');
        var formHtml = '<div class="rb-box">';
        if(count<25){
            for (var i = count; i < count + 5; i++) {
                var tmpArr = new Array();
                var strArr = questionArr[i];
                console.log(strArr) ;
                tmpArr = strArr.split(' ');
                formHtml += '<div id="rb-' + (i + 1).toString() + '"class="rb"><div class="rb-tab">\
                <div class="rb-spot" style="margin-left:35%;"><div>'+ (i + 1).toString() + '</div></div></div><div class="rb-tab" data-value="A">\
                <div class="rb-spot"><div>'+ tmpArr[0] + '</div></div></div><div class="rb-tab" data-value="B">\
                <div class="rb-spot"><div>'+ tmpArr[1] + '</div></div></div><div class="rb-tab" data-value="C">\
                <div class="rb-spot"><div>'+ tmpArr[2] + '</div></div></div><div class="rb-tab" data-value="D">\
                <div class="rb-spot"><div>'+ tmpArr[3] + '</div></div></div></div><br><br>';
            }
            count += 5;
            $('#pageNum').text(pageNum+'/5');
        }else{
            $('#part').text('Part II 風險屬性分析');
            var tmpArr = new Array();
            var strArr = questionArr[(count-25)];
            tmpArr = strArr.split(' ');
            formHtml += '<div id="rb-' + count.toString() + '><div class="qtitle">'+ (count-24).toString()+'　　'+tmpArr[0] +'</div><br>\
                <div class="partIIcontent"data-value="A">'+ tmpArr[1] +'</div><br>\
                <div class="partIIcontent" data-value="B">'+ tmpArr[2] +'</div><br>\
                <div class="partIIcontent" data-value="C">'+ tmpArr[3] +'</div><br>\
                <div class="partIIcontent" data-value="D">'+ tmpArr[4] +'</div><br>\
                <div class="partIIcontent" data-value="E">'+ tmpArr[5] +'</div><br></div>';
            count ++;
            $('#pageNum').text(pageNum + '/12');
            $('#nextQuestion').text('Next');
        }
        if (count == 25) {
            $('#nextQuestion').text('Go To The Next Part');
            pageNum = 0;
            // $('#nextQuestion').attr("data-dismiss", "modal");
        }
        if(count == 37){
            $('#nextQuestion').text('Done');
        }
        $('#questionContent').html(formHtml);
    }

    function debug(survey) {
        var debug = "";
        for (i = 0; i < survey.length; i++) {
            debug += "Nº " + survey[i][0] + " = " + survey[i][1] + "\n";
        };
        alert(debug);
    };
</script> {% endblock %}